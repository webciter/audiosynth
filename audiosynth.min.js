!function(){let t=window.URL||window.webkitUR,n=window.Blob;var e,i,o,a,l=Uint8Array;a=Math,function(){let s=null,r=function(t,n){return[new l([n,n>>8]),new l([n,n>>8,n>>16,n>>24])][t]},u=function(t,n,e,i){Object.defineProperty(this,t,{value:n,writable:!!e,enumerable:!!i})},h=function(t,n,e){u.call(this,t,n,e,!0)},f=u.bind((o=function(){this.__init__.apply(this,arguments)}).prototype),_=h.bind(o.prototype);f("__init__",function(t,n,e){if(!bb)throw new X("Invalid AudioSynthInstrument instantiation.");u.call(this,"_p",t),h.call(this,"name",n),u.call(this,"_sI",e)}),_("play",function(t,n,e){return this._p.play(this._sI,t,n,e)}),_("generate",function(t,n,e){return this._p.generate(this._sI,t,n,e)}),f=u.bind((i=function t(){return s instanceof t?s:(this.__init__(),this)}).prototype),_=h.bind(i.prototype),f("_d",!1,!0),f("_b",16),f("_ch",1),f("_sa",44100,!0),_("setSampleRate",function(t){return this._sa=a.max(a.min(0|t,44100),4e3),this._c(),this._sa}),_("getSampleRate",function(){return this._sa}),f("_v",32768,!0),_("setVolume",function(t){return t=parseFloat(t),isNaN(t)&&(t=0),t=a.round(32768*t),this._v=a.max(a.min(0|t,32768),0),this._c(),this._v}),_("getVolume",function(){return a.round(this._v/32768*1e4)/1e4}),f("_n",{C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88}),f("_f",[],!0),f("_t",{},!0),f("_s",[],!0),f("_m",[function(t,n,e,i){return a.sin(2*a.PI*(t/n)*e+i)}]),f("_re",function(){let t=this._f,n=this._s.length;for(;t.length<n;){let n=[];for(let t=0;t<8;t++){let t={};for(let n in this._n)t[n]={};n.push(t)}t.push(n)}}),f("_c",function(){this._f=[],this._re()}),_("generate",function(e,i,o,s){let u=this._s[e];if(!u)for(let t=0;t<this._s.length;t++)if(this._s[t].name==e){u=this._s[t],e=t;break}if(!u)throw new X("Invalid sound/ID: "+e);let h=(new Date).valueOf();this._t={},o|=0,o=a.min(8,a.max(1,o));let f=s?parseFloat(s):2;if(void 0===this._n[i])throw new X(i+" invalid note");if(void 0!==this._f[e][o-1][i][f])return this._d&&console.log((new Date).valueOf()-h,"ms to retrieve (cached)"),this._f[e][o-1][i][f];{let s=this._n[i]*a.pow(2,o-4),_=this._sa,c=this._v,d=this._ch,p=this._b,w=u.attack(_,s,c),m=u.dampen(_,s,c),v=u.wave,b={modulate:this._m,vars:this._t},g=0,y=new l(new ArrayBuffer(a.ceil(_*f*2))),I=_*w|0,A=_*f|0,S=0;for(S=0;S!==I;S++)g=c*(S/(_*w))*v.call(b,S,_,s,c),y[S<<1]=g,y[1+(S<<1)]=g>>8;for(;S!==A;S++)g=c*a.pow(1-(S-_*w)/(_*(f-w)),m)*v.call(b,S,_,s,c),y[S<<1]=g,y[1+(S<<1)]=g>>8;let k=["RIFF",r(1,52),"WAVE","fmt ",r(1,16),r(0,1),r(0,d),r(1,_),r(1,_*d*p/8),r(0,d*p/8),r(0,p),"data",r(1,y.length*d*p/8),y],F=new n(k,{type:"audio/wav"}),V=t.createObjectURL(F);return this._f[e][o-1][i][f]=V,this._d&&console.log((new Date).valueOf()-h,"ms to generate"),V}}),_("play",function(t,n,e,i){let o=this.generate(t,n,e,i);return new Audio(o).play(),!0}),_("debug",function(){this._d=!0}),_("createInstrument",function(t){let n=0,e=!1;if("string"==typeof t){for(let i=0;i<this._s.length;i++)if(this._s[i].name==t){e=!0,n=i;break}}else this._s[t]&&(n=t,t=this._s[n].name,e=!0);if(!e)throw new X("Invalid sound/ID: "+t);bb=!0;let i=new o(this,t,n);return bb=!1,i}),_("listSounds",function(){let t=[];for(let n=0;n<this._s.length;n++)t.push(this._s[n].name);return t}),f("__init__",function(){this._re()}),_("loadSoundProfile",function(){for(let t=0;t<arguments.length;t++){let n=arguments[t];if(!(n instanceof Object))throw new X("Invalid sound profile.");this._s.push(n)}return this._re(),!0}),_("loadModulationFunction",function(){for(let t=0;t<arguments.length;t++){let n=arguments[t];if("function"!=typeof n)throw new X("Invalid modulation function.");this._m.push(n)}return!0}),s=new i,e=s}();let s=(t,n,e,i,o,l)=>o*a.sin(l*a.PI*(t/n*e)+i);e.loadModulationFunction((t,n,e,i)=>s(t,n,e,i,1,2),(t,n,e,i)=>s(t,n,e,i,1,4),(t,n,e,i)=>s(t,n,e,i,1,8),(t,n,e,i)=>s(t,n,e,i,1,.5),(t,n,e,i)=>s(t,n,e,i,1,.25),(t,n,e,i)=>s(t,n,e,i,.5,2),(t,n,e,i)=>s(t,n,e,i,.5,4),(t,n,e,i)=>s(t,n,e,i,.5,8),(t,n,e,i)=>s(t,n,e,i,.5,.5),(t,n,e,i)=>s(t,n,e,i,.5,.25)),e.loadSoundProfile({name:"piano",attack:()=>.002,dampen:(t,n,e)=>a.pow(.5*a.log(n*e/t),2),wave:function(t,n,e,i){let o=this.modulate[0];return this.modulate[1](t,n,e,a.pow(o(t,n,e,0),2)+.75*o(t,n,e,.25)+.1*o(t,n,e,.5))}},{name:"organ",attack:()=>.3,dampen:(t,n)=>1+.01*t,wave:function(t,n,e){let i=this.modulate[0];return this.modulate[1](t,n,e,i(t,n,e,0)+.5*i(t,n,e,.25)+.25*i(t,n,e,.5))}},{name:"acoustic",attack:()=>.002,dampen:()=>1,wave:function(t,n,e){let i=this.vars;i.valueTable=i.valueTable?i.valueTable:[],void 0===i.playVal&&(i.playVal=0),void 0===i.periodCount&&(i.periodCount=0);let o=i.valueTable,l=i.playVal,s=i.periodCount,r=n/e,u=a.floor(100*(r-a.floor(r))),h=!1;if(o.length<=a.ceil(r))return o.push(2*a.round(a.random())-1),o[o.length-1];o[l]=.5*(o[l>=o.length-1?0:l+1]+o[l]),l>=a.floor(r)&&(l<a.ceil(r)?s%100>=u&&(h=!0,o[l+1]=.5*(o[0]+o[l+1]),i.periodCount++):h=!0);var f=o[l];return h?i.playVal=0:i.playVal++,f}},{name:"edm",attack:()=>.002,dampen:()=>1,wave:function(t,n,e){let i=this.modulate[0],o=this.modulate.slice(1);return o[0](t,n,e,o[9](t,n,e,o[2](t,n,e,a.pow(i(t,n,e,0),3)+a.pow(i(t,n,e,.5),5)+a.pow(i(t,n,e,1),7)))+o[8](t,n,e,i(t,n,e,1.75)))}}),window=Object.assign(window,{Synth:e,AudioSynth:i,AudioSynthInstrument:o})}();
